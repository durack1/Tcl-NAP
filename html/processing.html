<!-- $Id: nap_cmd.html,v 1.3 2004/07/19 02:32:27 dav480 Exp $ -->
<html>

<head> <title>
Arithmetic and Array Processing
</title> </head>

<body>

<h2> <center>
Arithmetic and Array Processing
</center> </h2>

<h3>Table of Contents</h3>

<ol>
    <li><a href="#Introduction">Introduction</a>
    <li><a href="#data-type">Data-type of result</a>
</ol>

<h3>
<a name=Introduction>Introduction
</h3>

<p>
How is the shape and data-type of the result of an operation 
(defined by an operator or a function) 
related to the shape and data-type of the operands/arguments?
For example, consider the addition of two <code>i32</code> (32-bit integer) 2-element vectors:

<PRE>
% [nap "{2 5} + {4 3}"] all
::NAP::20-20  i32  MissingValue: -2147483648  References: 0  Unit: (NULL)
Dimension 0   Size: 2      Name: (NULL)    Coordinate-variable: (NULL)
Value:
6 8
</PRE>

<p>
The result is also an <code>i32</code> 2-element vector.
Each element of the result is the sum of the corresponding elements of the operands.
In other words addition is an <em>element-by-element</em> operation.

<h3>
<a name=data-type>Data-type of result
</h3>

<p>
Many operations 
(defined by an operator or a function) 
produce a result whose data-type matches that of their operands/arguments 
(if these all have the same data-type).
The following examples illustrate this for the <em>subtract</em> operator:

<PRE>
% [nap "3 - 1"] all
::NAP::57-57  i32  MissingValue: -2147483648  References: 0  Unit: (NULL)
Value:
2
% [nap "3f32 - 1f32"] all
::NAP::61-61  f32  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
2
% [nap "3u8 - 1u8"] all
::NAP::65-65  u8  MissingValue: 255  References: 0  Unit: (NULL)
Value:
2
</PRE>

<p>
What happens if the operands differ in data-type?
Let's try adding <code>i32</code> and <code>f32</code> values:

<PRE>
% [nap "234 + 3.5f32"] all
::NAP::54-54  f64  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
237.5
</PRE>

<P>
Why is the result <code>f64</code> rather than <code>f32</code>?
This prevents possible loss of precision, as in:

<PRE>
% [nap "f32(123456789) + 5f32"] all -format %d
::NAP::48-48  f32  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
123456800
</PRE>

This is due to the fact that an
<code>i32</code> value has 31 bits (9.3 digits) of precision, whereas
an <code>f32</code> value has only 24 bits (7.2 digits) of precision.
So both operands must be converted to <code>f64</code> before the addition takes place.
This is shown by:

<PRE>
% [nap "123456789 + 5f32"] all -format %d
::NAP::43-43  f64  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
123456794
</PRE>

<h3>
<a name=more>more
</h3>

<p>
What happens if the operands differ in shape and/or data-type?
Let's try adding an <code>i32</code> matrix to a <code>f32</code> vector.

<PRE>
% [nap "{{1 3 -2}{4 0 9}} + f32{5 8 -7}"] all
::NAP::30-30  f64  MissingValue: NaN  References: 0  Unit: (NULL)
Dimension 0   Size: 2      Name: (NULL)    Coordinate-variable: (NULL)
Dimension 1   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
 6 11 -9
 9  8  2
</PRE>


The data-type of the result is 
<code>f64</code> because this is the only type which 

<P>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2" bgcolor="737b9c">
  <TR>
    <TD align="center"><FONT color="#ffffff" size=-2><SPAN class="titlebar">
        <b>Author:</b> <a href="http://sourceforge.net/users/dav480/">Harvey Davies</a>
        &nbsp; &nbsp; &nbsp;
        &copy; 2002, CSIRO Australia.
        &nbsp; &nbsp; &nbsp;
        <a href="http://www.csiro.au/legalnotices/disclaimer.html">Legal Notice and Disclaimer</a>
        <br>

        <b>CVS Version Details:</b> $Id: nap_cmd.html,v 1.3 2004/07/19 02:32:27 dav480 Exp $
        </SPAN></FONT>
    </TD>
  </TR>
</TABLE>

</body>
</html>

