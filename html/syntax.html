<!-- $Id: syntax.html,v 1.3 2004/10/28 05:26:55 dav480 Exp $ -->
<html>

<head> <title>
Syntax of NAP Expressions
</title> </head>

<body>

<h2> <center>
Syntax of NAP Expressions
</center> </h2>

<h3>Table of Contents</h3>

<ol>
    <li><a href="#Introduction">Introduction</a>
    <li><a href="#Substitution">Substitution</a>
    <li><a href="#Namespaces">Namespaces</a>
    <li><a href="#Functions">Functions</a>
    <li><a href="#Indexing">Indexing</a>
    <li><a href="#Parenthesising">Parenthesising Function Arguments and Indices</a>
</ol>

<h3><a name=Introduction>Introduction</h3>

<p>
The standard Tcl command&nbsp; &quot;<code>expr</code>&quot; is based on C 
conventions for operators and functions.
NAP expressions use similar conventions and can include any 
of the following tokens separated by white-space characters:
<ul>
    <li>Operands
    <ul>
	<li>OOC-names
	<li>names of Tcl variables (may include namespaces)
	<li>constants
	<ul>
	    <li>numeric scalar
	    <li>numeric array
	    <li>string
	</ul>
    </ul>
    <li>Operators (including assignment operator &quot;<code>=</code>&quot;)
    <li>Parentheses (&quot;<code>()</code>&quot;)
    <li>Function names
    <ul>
	<li>built-in functions
	<li>names (may include namespaces) of Tcl procedures defining NAP functions 
    </ul>
    <li>Tcl substitution characters (&quot;<code>[]$</code>&quot;)
</ul>

<h3><a name=Substitution>Substitution</h3>

<p>
Like
&quot;<code>expr</code>&quot;,
nap does the Tcl substitution defined by any brackets and dollars 
(&quot;<code>[]$</code>&quot;)
remaining after normal command parsing.

<p>
However, unlike
&quot;<code>expr</code>&quot;,
nap also substitutes for Tcl variable names that are not preceded by a
&quot;<code>$</code>&quot;
(except where the name is the left operand of the assignment operator
&quot;<code>=</code>&quot;).
The value of the Tcl name is treated as a NAP expression, which is evaluated
and the OOC-name of the result replaces the name.
This substitution is repeated (up to eight times) until a single OOC-name is
generated.
The expressions in the following example include:
<ul>
    <li>Tcl variable <code>length</code> containing the string &quot;<code>3.5</code>&quot;
    <li>Tcl variable <code>breadth</code> defined by NAP to contain
	&quot;<code>::NAP::13-13</code>&quot;
    <li>NAP constants <code>2</code> and <code>10</code>
    <li>Tcl variable <code>area</code> containing the string
	&quot;<code>length * breadth</code>&quot;
</ul>

<PRE>
% set length 3.5
3.5
% nap "breadth = 2"
::NAP::13-13
% [nap "2 * (length + breadth)"]
11
% set area "length * breadth"
length * breadth
% [nap "10 * area"]
70
</PRE>

<p>
Each constant is replaced by the OOC-name of a NAO representing its value.
After substitution,
the expression consists of OOC-names, operators, function names and
parentheses.

<p>
Similarly one can use a Tcl variable as a generic function, as in:

<PRE>
% set f sqrt
sqrt
% [nap "f 9"]
3
</PRE>

<h3><a name=Namespaces>Namespaces</h3>

<p>
NAP allows names which include namespaces, as in:

<PRE>
% namespace eval ::mySpace {}; # create namespace "mySpace"
% nap "::mySpace::x = 8"
::NAP::13-13
% [nap "3 + ::mySpace::x"]
11
</PRE>

<h3><a name=Functions>Functions</h3>

<p>
Function arguments can be enclosed by parentheses (as required
by many other languages), but these parentheses are not required by the syntax.
A name (which cannot be a Tcl variable name or it would have been substituted)
followed by an operand (now an OOC-name) is treated as a function name. 
Thus the following two commands are equivalent:

<PRE>
% [nap "sin(3.14)"]
0.00159265
% [nap "sin 3.14"]
0.00159265
</PRE>

<p>
Multiple arguments are separated by commas in the usual way.
For example:

<PRE>
% [nap "hypot(3,4)"]
5
</PRE>

<p>
A comma is treated as a low-precedence operator which produces a <em>boxed</em> array.
The parentheses <em>are</em> needed to force the comma to be executed before the function.
The fact that comma is just another operator is shown by:

<PRE>
% nap "both = 3,4"
::NAP::33-33
% $both all
::NAP::33-33  boxed  MissingValue: 0  References: 1  Unit: (NULL)
Dimension 0   Size: 2      Name: (NULL)    Coordinate-variable: (NULL)
Value:
31 32
% [nap "hypot both"]
5
</PRE>

<h3><a name=Indexing>Indexing</h3>

<p>
Tcl array indices are enclosed by parentheses 
(&quot;<code>()</code>&quot;),
while C uses brackets
(&quot;<code>[]</code>&quot;).
NAP requires neither, since indexing is simply implied by adjacent operands (now OOC-names).
Thus the following two commands 
(which give elements 1, 0, 2 and 0 of the vector 
<code>{5 7 6}</code>)
are equivalent:

<PRE>
% [nap "{5 7 6}({1 0 2 0})"]
7 5 6 5
% [nap "{5 7 6}{1 0 2 0}"]
7 5 6 5
</PRE>

<h3><a name=Parenthesising>Parenthesising Function Arguments and Indices</h3>

<p>
As explained above, there is no syntactic need for parentheses around single function
arguments and array indices.
However, since most other computer languages do require such parentheses, 
it may aid human readability to include them.

<p>
Multiple function arguments and cross-product-indexing are both defined using a <em>boxed</em>
argument. 
A boxed argument is normally produced using the comma operator.
The comma operator has low precedence, so parentheses <em>are</em> normally
needed for multiple function arguments and cross-product-indexing.
The following example shows how an element of a matrix can be extracted using either
<em>full</em> or <em>cross-product</em> indexing:

<PRE>
% nap "matrix = {
{2 3 4}
{5 6 7}
}"
::NAP::30-30
% [nap "matrix{0 2}"]; # Full index
4
% [nap "matrix(0,2)"]; # Cross-product index
4
</PRE>

<P>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2" bgcolor="737b9c">
  <TR>
    <TD align="center"><FONT color="#ffffff" size=-2><SPAN class="titlebar">
        <b>Author:</b> <a href="http://sourceforge.net/users/dav480/">Harvey Davies</a>
        &nbsp; &nbsp; &nbsp;
        &copy; 2002-2004, CSIRO Australia.
        &nbsp; &nbsp; &nbsp;
        <a href="http://www.csiro.au/legalnotices/disclaimer.html">Legal Notice and Disclaimer</a>
        <br>

        <b>CVS Version Details:</b> $Id: syntax.html,v 1.3 2004/10/28 05:26:55 dav480 Exp $
        </SPAN></FONT>
    </TD>
  </TR>
</TABLE>

</body>
</html>

