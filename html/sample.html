<!-- $Id: sample.html,v 1.4 2002/08/07 08:07:56 dav480 Exp $ -->
<html>

<head> <title>
NAP Sample Session
</title> </head>

<body>

<h2> <center>
NAP Sample Session
</center> </h2>

<p>
The following sample session illustrates some basic features of NAP.
The input command lines begin with the standard Tcl prompt
&quot;<code>%</code>&quot;.
</p>

<PRE>
    % nap &quot;x = {2 2.5 5}&quot;
    ::NAP::13-13
    % nap &quot;y = x * x&quot;
    ::NAP::14-14
    % $y
    4 6.25 25
</PRE>
  
<p>
The first command assigns to <code>x</code> a vector containing the three elements
2, 2.5 and 5.
The second command assigns to <code>y</code> a vector containing the three elements
which are the squares of the corresponding elements of <code>x</code>.
The command &quot;<code>$y</code>&quot; returns the value of <code>y</code>.
  
<p>
Nap stores each variable in memory using a data-structure called an
<em>n-dimensional array object</em> (<em>NAO</em>).
Each NAO has an associated Tcl command called its <em>object-oriented command</em>
(<em>OOC</em>) which is used to
<li>obtain data and other information from the NAO
<li>write data from the NAO to files and internal structures
<li>modify the NAO.

<p>
An <em>OOC-name</em>
(command-name of an OOC)
is used
<li> to execute the OOC (like any other Tcl command)
<li> as a unique identifier for the NAO associated with the OOC.

<br>
An OOC-name has the form <code>::NAP::</code><i>seq</i><code>-</code><i>slot</i>, where 
<li><code>::NAP::</code> is the Tcl namespace used by NAP
<li><i>seq</i> is the <i>sequence number</i> assigned in order of creation
<li><i>slot</i> is the index of an internal table used to provide fast access.

<br>
In the above example, both OOC-names (<code>::NAP::13-13</code> 
and <code>::NAP::14-14</code>) have slots equal to their sequence number, but 
this is not the case in general since the slots of deleted NAOs may be reused.
</p>

<p>
An assignment (&quot;<code>=</code>&quot;) operator has on its left a standard 
Tcl variable name which is assigned the (string) value of the OOC-name.
Continuing the above example, these string values can be displayed using the
standard Tcl command <code>set</code>.
</p>

<PRE>
  <code>
  % set x
  ::NAP::13-13
  % set y
  ::NAP::14-14
  </code>
</PRE>

<p>
Thus the command &quot;<code>$y</code>&quot; is equivalent to the command &quot;<code>::NAP::14-14</code>&quot;.
&nbsp; Confirming this:
</p>

<PRE>
  <p><code>% ::NAP::14-14
    4 6.25 25</code></p>
</PRE>

<p>
If an OOC has no arguments (as above) then it returns the value of the 
NAO (abbreviated if the NAO is large). Arguments can be specified as in:
</p>

<PRE>
<p><code>
  % $x all
::NAP::13-13  f64  MissingValue: NaN  References: 1  Unit: (NULL)
Dimension 0   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
2 2.5 5
</code></p>
</PRE>

<p>This illustrates the &quot;<code>all</code>&quot; 
<em>method</em> (sub-command),
which provides a more
detailed description of the NAO than the default method. The&nbsp; following example uses
the &quot;<code>set value</code>&quot; method to change the value of element 1 of <code>x</code>
from 6.25 to 7.
</p>

<PRE>
% $x set value 7 1
% $x all
::NAP::13-13  f64  MissingValue: NaN  References: 1  Unit: (NULL)
Dimension 0   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
2 7 5
</PRE>

<p>
The similarity between the &quot;<code>expr</code>&quot; and
&quot;<code>nap</code>&quot; commands for simple arithmetic is shown by:
</p>

<PRE>
% expr "2 * (1 - 0.25)"
1.5
% nap "2 * (1 - 0.25)"
::NAP::25-25
% ::NAP::25-25
1.5
% ::NAP::25-25
invalid command name "::NAP::25-25"
</PRE>

<p>
Note that the command
&quot;<code>::NAP::25-25</code>&quot;
worked the first time but failed when it was repeated.
The NAOs reference count was zero, as it was not referenced by anything (e.g. a Tcl variable).
So the NAO and its associated OOC were automatically deleted after the first execution of
the OOC.
</p>

<p>
The need to type the additional command &quot;<code>::NAP::25-25</code>&quot;
can be obviated using the Tcl bracket (&quot;<code>[]</code>&quot;) notation. Tcl
executes the bracketed command, substitutes its result and then executes the
generated command. So the above can be replaced by:
</p>

<PRE>
% [nap &quot;2 * (1 - 0.25)&quot;]
1.5
</PRE>

<p>
The following example illustrates <em>array indexing</em> and the
calculation of an <em>arithmetic-mean</em> (both directly and by defining a function).
The first two commands:
<ul>
<li> define a 32-bit floating-point vector containing the five values 56, 75, 47, 99  and 49
<li> assign it to the variable <code>score</code>
<li> display it
</ul>

<PRE>
% nap "score = f32{56 75 47 99 49}"
::NAP::16-16
% $score all
::NAP::16-16  f32  MissingValue: NaN  References: 1  Unit: (NULL)
Dimension 0   Size: 5      Name: (NULL)    Coordinate-variable: (NULL)
Value:
56 75 47 99 49
</PRE>

<p>
The following four commands respectively illustrate:
<ol>
<li> indexing a vector by a scalar &quot;<code>2</code>&quot; to give a scalar
<li> indexing a vector by a vector &quot;<code>{2 0 4}</code>&quot; to give a vector
<li> the operator &quot;<code>..</code>&quot; which defines an <em>arithmetic progression</em>
<li> the use of such an arithmetic progression as an index
</ol>

<PRE>
% [nap "score(2)"] all
::NAP::20-20  f32  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
47
% [nap "score({2 0 4})"] all
::NAP::25-25  f32  MissingValue: NaN  References: 0  Unit: (NULL)
Dimension 0   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
47 56 49
% [nap "0 .. 3"]
0 1 2 3
% [nap "score(0 .. 3)"]
56 75 47 99
</PRE>

<p>
The following three commands respectively illustrate:
<ol>
<li> function <code>sum</code>, which has the functionality of mathematical &quot;&Sigma;&quot;
<li> function <code>nels</code>, which gives the <em>number of elements</em>
<li> the use of these functions to calculate an <em>arithmetic-mean</em>
</ol>

<PRE>
% [nap "sum(score)"]
326
% [nap "nels(score)"]
5
% [nap "sum(score) / nels(score)"]
65.2
</PRE>

<p>
The following two commands respectively illustrate:
<ol>
<li> the definition of a tcl procedure to calculate an arithmetic-mean using NAP
<li> the calling of this procedure as a NAP function
</ol>

<PRE>
% proc mean x {nap "sum(x)/nels(x)"}
% [nap "mean(score)"]
65.2
</PRE>

<p>
Procedures defining NAP functions have arguments and results which are OOC-names.
All the facilities of Tcl and NAP can be used.
So recursion is allowed, as shown by the following <em>factorial</em> example:

<PRE>
% proc factorial n {
    if {[[nap "n > 1"]]} {
	nap "n * factorial(n-1)"
    } else {
	nap "1"
    }
}
% [nap "factorial(4)"]
24
</PRE>

<P>
Note the double brackets (inside braces) in the first line of the body of the above procedure.
The inner brackets produce an OOC-name.
The outer brackets execute this OOC to produce the string 
&quot;<code>0</code>&quot;
or
&quot;<code>1</code>&quot;.

<P>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2" bgcolor="737b9c">
  <TR>
    <TD align="center"><FONT color="#ffffff" size=-2><SPAN class="titlebar">
        <b>Author:</b> <a href="http://sourceforge.net/users/dav480/">Harvey Davies</a>
        &nbsp; &nbsp; &nbsp;
        &copy; 2002, CSIRO Australia.
        &nbsp; &nbsp; &nbsp;
        <a href="http://www.csiro.au/legalnotices/disclaimer.html">Legal Notice and Disclaimer</a>
        <br>

        <b>CVS Version Details:</b> $Id: sample.html,v 1.4 2002/08/07 08:07:56 dav480 Exp $
        </SPAN></FONT>
    </TD>
  </TR>
</TABLE>

</body>
</html>

