<!-- $Id: array.html,v 1.1 2004/11/05 06:25:54 dav480 Exp $ -->
<html>

<head> <title>
Arrays
</title> </head>

<body>

<h2> <center>
Arrays
</center> </h2>

<h3>Table of Contents</h3>

<ol>
    <li><a href="#Introduction">Introduction</a>
    <li><a href="#Vectors">Vectors</a>
    <li><a href="#Matrices">Matrices</a>
    <li><a href="#Higher">Higher Rank Arrays</a>
    <li><a href="#Grids">Grids</a>
    <li><a href="#Strings">Strings</a>
</ol>

<h3>
<a name=Introduction>Introduction
</h3>

NAP stores data in <em>NAOs</em>.
A NAO is essentially an object based on the concept of an <em>n-dimensional array</em>.
The number of dimensions is called the <em>rank</em>.
A scalar is simply an array of rank 0.

<p>
Dimensions can have names and <em>coordinate variables (CVs)</em>.
A CV maps a subscript to another variable such as a physical dimension (e.g. time).
Arrays with CVs are called <em>grids</em>.

<p>
NAP provides powerful and efficient facilities for processing arrays, including:
<ul>
    <li> <em>elemental</em> (element by element) extension of scalar arithmetic
    <li> array operations such as sum, concatenation and reshaping
    <li> indexing in a variety of ways
    <li> searching (inverse indexing)
</ul>

<h3>
<a name=Vectors>Vectors
</h3>

An array with exactly one dimension is called a <em>vector</em>.

<p>
NAP array constants are enclosed in braces "<code>{}</code>".
The following example doubles a vector containing four elements:
<PRE>
% [nap "2 * {3.4 -0.1 _ 7}"]
6.8 -0.2 _ 14
</PRE>
Note that an underscore ("<code>_</code>") represents a missing element.

<p>
The ordinary scalar arithmetic operators and functions are applied to arrays in
an elemental fashion, as shown by:
<PRE>
% [nap "{1 _ 4 -6} + {2 0 -9 _}"]
3 _ -5 _
% [nap "sqrt(-{1 _ 9 -6} + 10)"]
3 _ 1 4
</PRE>

<p>
The function <code>sum</code> has the functionality of the mathematical &quot;&Sigma;&quot;.
When applied to a vector it returns the sum of the elements (ignoring any that
are missing), as shown by:

<PRE>
% [nap "sum{1 _ 9 -6 3}"]
7
</PRE>

<p>
The following example applies the concatenation operator "<code>//</code>"
to vectors and scalars:

<PRE>
% [nap "{1 _ 9} // 7 // {-3 8}"]
1 _ 9 7 -3 8
</PRE>

<p>
The operators "<code>..</code>" and "<code>...</code>" generate 
<em>arithmetic progression (AP)</em>
vectors.
For example:

<PRE>
% [nap "3 .. 7"]
3 4 5 6 7
% [nap "7 .. 3"]
7 6 5 4 3
% [nap "0 .. 10 ... 2.5"]; # From 0 to 10 with step of 2.5
0 2.5 5 7.5 10
% [nap "5 ... 0 .. 10"]; # 5 elements from 0 to 10
0 2.5 5 7.5 10
</PRE>

<p>
An <em>index</em> specifies a position within an array, commencing from 0.
If two operands (representing NAOs) are adjacent then NAP treats the right operand as
the index of the left operand.
For example:

<PRE>
% nap "abc = {4 9 8 2}"
::NAP::283-283
% [nap "abc(2)"]
8
% [nap "abc 0"]; # parentheses not needed
4
% [nap "abc{2 0 3 2 1}"]; # vector index
8 4 2 8 9
</PRE>

<p>
Some computer languages allow indexed variable names on the left of the assignment operator
"<code>=</code>".
So one might expect to be able to modify element 2 of
<code>abc</code>
as follows:

<PRE>
% nap "abc(2) = 5"
abc(2) = 5
       ^
syntax error, unexpected '=', expecting $end
Error at line 1768 of file napParse.tab.c
</PRE>

<p>
NAP does not allow indexed variable names on the left of the assignment operator
"<code>=</code>".
However the 
"<code>set value</code>"
OOC method does provide a way to modify elements of a NAO.
Element 2 of
<code>abc</code>
can be changed to 5 as follows:

<PRE>
% $abc set value 5 2
% $abc
4 9 5 2
</PRE>

<p>
The following examples show how several elements (or the entire array)
can be changed using a single OOC:

<PRE>
% $abc set value "{13 11}" "{0 2}"
% $abc
13 9 11 2
% $abc set value -3
% $abc
-3 -3 -3 -3
% $abc set value "{13 11}"
% $abc
13 11 13 11
</PRE>

<p>
The default OOC displays only the first six elements, as in:

<PRE>
% [nap "1 .. 9"]
1 2 3 4 5 6 ..
</PRE>

<p>
The "<code>value</code>" OOC method displays all elements, as in:

<PRE>
% [nap "1 .. 9"] value
1 2 3 4 5 6 7 8 9
</PRE>

<h3>
<a name=Matrices>Matrices
</h3>

An array with exactly two dimensions is called a <em>matrix</em>.

<p>
A matrix constant has two levels of braces, as in:

<PRE>
% [nap "{{2 4 8}{0 -1 9}}"] all
::NAP::298-298  i32  MissingValue: -2147483648  References: 0
Dimension 0   Size: 2      Name: (NULL)    Coordinate-variable: (NULL)
Dimension 1   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
 2  4  8
 0 -1  9
</PRE>

<p>
It is often convenient to use a separate line for each row, as in:

<PRE>
% nap "mat = {
{2 1.5 7}
{0  -2 1.1}
}"
::NAP::301-301
% $mat all
::NAP::301-301  f64  MissingValue: NaN  References: 1
Dimension 0   Size: 2      Name: (NULL)    Coordinate-variable: (NULL)
Dimension 1   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
 2.0  1.5  7.0
 0.0 -2.0  1.1
</PRE>

<p>
The function "<code>sum</code>" gives column and row sums, as in:

<PRE>
% [nap "sum(mat)"]
2 -0.5 8.1
% [nap "sum(mat, 1)"]
10.5 -0.9
</PRE>

<p>
Matrices (and higher rank arrays) can be indexed using either
<em>cross-product indexing</em>
or
<em>full indexing</em>.
A cross-product index of a matrix has the form
"<var>rows</var>,<var>columns</var>", where
<var>rows</var> and <var>columns</var>
are scalars or vectors.
Here are two examples of cross-product indexing:

<PRE>
% [nap "mat(0,2)"]
7
% [nap "mat(0 .. 1, {0 2})"]
2.0 7.0
0.0 1.1
</PRE>

<p>
A full index of a matrix is an array with two columns corresponding to 
<em>row</em> and <em>column</em>.
Here are two examples of full indexing:

<PRE>
% [nap "mat{0 2}"]
7
% [nap "mat{{0 2}{0 0}{1 3}}"]
7 2 0
</PRE>

<p>
The function "<code>transpose</code>" swaps the row and column dimensions.
E.g.

<PRE>
% $mat
 2.0  1.5  7.0
 0.0 -2.0  1.1
% [nap "transpose mat"]
 2.0  0.0
 1.5 -2.0
 7.0  1.1
</PRE>

<p>
The function "<code>reshape</code>" uses the elements of the first argument 
(recycled if necessary)
to produce an array whose shape is specified by the second argument.
If there is only one argument then this is reshaped to a vector with the same number of
elements.
E.g.

<PRE>
% [nap "reshape(mat, {3 4})"]
 2.0  1.5  7.0  0.0
-2.0  1.1  2.0  1.5
 7.0  0.0 -2.0  1.1
% [nap "reshape mat"]
2 1.5 7 0 -2 1.1
% [nap "reshape(9, {2 5})"]
9 9 9 9 9
9 9 9 9 9
</PRE>

<p>
The concatenation operator "<code>//</code>" can be applied to matrices.
For example:

<PRE>
nap "m33 = {{4 6 8}{3 5 9}{0 4 1}}"
::NAP::14-14
% $m33
4 6 8
3 5 9
0 4 1
% $mat
 2.0  1.5  7.0
 0.0 -2.0  1.1
% [nap "m33 // mat"]
 4.0  6.0  8.0
 3.0  5.0  9.0
 0.0  4.0  1.0
 2.0  1.5  7.0
 0.0 -2.0  1.1
</PRE>

<p>
The laminate operator "<code>///</code>" joins its operands over a new dimension.
The following example creates a matrix from two vectors:

<PRE>
% [nap "{9 3 5} /// {1 7 2}"]
9 3 5
1 7 2
% [nap "{9 3 5} // {1 7 2}"]; # Note difference
9 3 5 1 7 2
</PRE>

<h3>
<a name=Higher>Higher Rank Arrays
</h3>

A NAO can have up to 32 dimensions.
The following example creates a 3-dimensional array, sums it along each dimension,
then extracts an element using cross-product indexing.

<PRE>
% nap "a3D = reshape(0 .. 99, {2 3 4})"
::NAP::47-47
% $a3D 
 0  1  2  3
 4  5  6  7
 8  9 10 11

12 13 14 15
16 17 18 19
20 21 22 23
% [nap "sum(a3D)"]
12 14 16 18
20 22 24 26
28 30 32 34
% [nap "sum(a3D, 1)"]
 6 22 38
54 70 86
% [nap "sum(a3D, 2)"]
12 15 18 21
48 51 54 57
% [nap "a3D(0,2,1)"]
9
</PRE>

<h3>
<a name=Grids>Grids
</h3>

<p>
Grids are arrays with <em>coordinate variables (CVs)</em>.
Dimensions often correspond to physical dimensions such as time and length.
A CV maps a subscript to another variable, 
which is typically a physical dimension such as time.

<p>
The following example creates a NAO corresponding to the grid described in
<a href="grid.html#Missing">Missing Data</a>.
Note how the "<code>set coo</code>" OOC method is used to attach the CVs
and name the dimensions.

<PRE>
% nap "latitude = {30 25 10 -10}"
::NAP::74-74
% nap "longitude = {30 40 60 65 75}"
::NAP::76-76
% nap "grid2d = {
{15 17 10  _ 21}
{16 14 18 18 19}
{ _ 11 12 11  _}
{10  9  _ 12 11}
}"
::NAP::78-78
% $grid2d set coo latitude longitude
% $grid2d all
::NAP::78-78  i32  MissingValue: -2147483648  References: 1
Dimension 0   Size: 4      Name: latitude  Coordinate-variable: ::NAP::74-74
Dimension 1   Size: 5      Name: longitude  Coordinate-variable: ::NAP::76-76
Value:
15 17 10  _ 21
16 14 18 18 19
 _ 11 12 11  _
10  9  _ 12 11
</PRE>

<p>
Grids can be indexed using <em>indirect indexing</em>, which is indexing via CVs.
Continuing the above example, let us extract the value corresponding to a latitude of 25
and a longitude of 75:

<PRE>
% [nap "grid2d(@25, @75)"]; # indirect indexing
19
% [nap "grid2d(1, 4)"]; # direct indexing
19
</PRE>

<p>
NAP allows fractional subscripts, which correspond to interpolated values.
The following produces a value corresponding to row 0.5 (27.5&deg;N) and column 1.5
(50&deg;E):

<PRE>
% [nap "grid2d(0.5, 1.5)"]; # direct indexing
14.75
% [nap "grid2d(@27.5, @50)"]; # indirect indexing
14.75
% expr (17+10+14+18) * 0.25; # check arithmetic
14.75
</PRE>

<h3>
<a name=Strings>Strings
</h3>

String constants are enclosed in apostrophes 
"<code>''</code>"
or grave accents
"<code>``</code>"
and generate character vectors.
For example:

<PRE>
% nap "message = 'hello world'"
::NAP::329-329
% $message all
::NAP::329-329  c8  MissingValue: (NULL)  References: 1
Dimension 0   Size: 11     Name: (NULL)    Coordinate-variable: (NULL)
Value:
hello world
% [nap "`don't`"]
don't
</PRE>

<p>
The following example uses the library function
"<code>gets_matrix</code>"
to read the text file 
"<code>abc.txt</code>"
into a NAO referenced by
"<code>in</code>".

<PRE>
% nap "in = gets_matrix('abc.txt')"
::NAP::349-349
% $in all
::NAP::349-349  f64  MissingValue: NaN  References: 1
Dimension 0   Size: 2      Name: (NULL)    Coordinate-variable: (NULL)
Dimension 1   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
 2  9 -3
 0 12  7
</PRE>

<P>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2" bgcolor="737b9c">
  <TR>
    <TD align="center"><FONT color="#ffffff" size=-2><SPAN class="titlebar">
        <b>Author:</b> <a href="http://sourceforge.net/users/dav480/">Harvey Davies</a>
        &nbsp; &nbsp; &nbsp;
        &copy; 2002, CSIRO Australia.
        &nbsp; &nbsp; &nbsp;
        <a href="http://www.csiro.au/legalnotices/disclaimer.html">Legal Notice and Disclaimer</a>
        <br>

        <b>CVS Version Details:</b> $Id: array.html,v 1.1 2004/11/05 06:25:54 dav480 Exp $
        </SPAN></FONT>
    </TD>
  </TR>
</TABLE>

</body>
</html>

