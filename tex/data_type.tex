%  $Id: data_type.tex,v 1.7 2006/06/07 04:58:19 dav480 Exp $ 
    % Data Types

\section{Data Types}
    \label{data-type}

\subsection{Nap Data-types}
    \label{data-type-Nap-Data-types}

A NAO can have any of the following data-types:
  
\begin{tabular}{|l|l|l|l|l|}
    \hline 
      \textbf{Name} & \textbf{Description} & \textbf{Minimum} & \textbf{Maximum}
	& \textbf{Default Missing Value}
    \\ \hline 
    \hline 
        \texttt{c8} & 8-bit character & 0 & 255 & 0
    \\ \hline 
        \texttt{i8} & 8-bit signed integer & -128 & 127 & -128
    \\ \hline 
        \texttt{i16} & 16-bit signed integer & -32768 & 32767 & -32768 
    \\ \hline 
        \texttt{i32} & 32-bit signed integer & -2147483648 & 2147483647 & -2147483648 
    \\ \hline 
        \texttt{u8} & 8-bit unsigned integer & 0 & 255 & none
    \\ \hline 
        \texttt{u16} & 16-bit unsigned integer & 0 & 65535 & 65535 
    \\ \hline 
        \texttt{u32} & 32-bit unsigned integer & 0 & 4294967295 & 4294967295 
    \\ \hline 
        \texttt{f32} & 32-bit floating-point & $-\infty$ & $\infty$ & NaN
    \\ \hline 
        \texttt{f64} & 64-bit floating-point & $-\infty$ & $\infty$ & NaN
    \\ \hline 
        \texttt{ragged} & slot numbers & 0 & 2147483647 & 0
    \\ \hline 
        \texttt{boxed} & slot numbers & 0 & 2147483647 & 0
    \\ \hline
\end{tabular}
  

The 
  \texttt{ragged} type provides an efficient way of storing arrays
  with many missing values around the edges.
  

A 
  \texttt{boxed} NAO contains slot numbers pointing to other NAOs.
  This allows one to construct arrays (normally vectors) of arrays.
  Boxed vectors are generated by the 
{\em link operators} `\texttt{...}' and `\texttt{,}' described in section
\ref{op-Link}.
Boxed vectors are used
\begin{bullets}
    \item to pass multiple arguments to a function
    \item to return multiple results from a function
    \item in 
    \emph{cross-product indexing}
    \item to generate 
    \emph{arithmetic progressions} with step sizes other than $1$ and $-1$
\end{bullets}
Boxed vectors can be unpacked using function 
  \texttt{open\_box(}$x$\texttt{)}, which is described in 
section \ref{function-Special-Data-types} (Functions related to Special Data-types).

\subsection{Data-type of Constants}
    \label{data-type-constant}

A scalar constant can contain a data-type suffix, as in:
  \begin{verbatim}
% [nap "3.7f32"] all
::NAP::53-53  f32  MissingValue: NaN  References: 0
Value:
3.7
% [nap "123u8"] all
::NAP::55-55  u8  MissingValue: (NULL)  References: 0
Value:
123
\end{verbatim}

The following examples show that if there is no such suffix then
floating-point values are treated as 
  \texttt{f64} while integer values are treated as 
  \texttt{i32}:
  \begin{verbatim}
% [nap "3.7"] all
::NAP::57-57  f64  MissingValue: NaN  References: 0
Value:
3.7
% [nap "123"] all
::NAP::58-58  i32  MissingValue: -2147483648  References: 0
Value:
123
\end{verbatim}

\subsection{Data-type Conversion Functions}
    \label{data-type-functions}

There is a function with the name of each data-type except 
  \texttt{ragged} and 
  \texttt{boxed}. Each such function converts its argument to that
  data-type. For example:
  \begin{verbatim}
% [nap "f64(123)"] all
::NAP::62-62  f64  MissingValue: NaN  References: 0
Value:
123
% [nap "c8(123)"] all; # ascii character 123 (left-brace i.e. '{')
::NAP::66-66  c8  MissingValue: (NULL)  References: 0
Value:
{
% [nap "f32({123 -1.2 0})"] all; # vector with 3 elements
::NAP::70-70  f32  MissingValue: NaN  References: 0
Dimension 0   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
123 -1.2 0
\end{verbatim}

  

The parentheses 
  \texttt{()} in these three examples are not needed. Deleting
  them:
  \begin{verbatim}
% [nap "f64 123"] all
::NAP::26-26  f64  MissingValue: NaN  References: 0
Value:
123
% [nap "c8 123"] all
::NAP::29-29  c8  MissingValue: (NULL)  References: 0
Value:
{
% [nap "f32{123 -1.2 0}"] all
::NAP::33-33  f32  MissingValue: NaN  References: 0
Dimension 0   Size: 3      Name: (NULL)    Coordinate-variable: (NULL)
Value:
123 -1.2 0
\end{verbatim}

\subsection{Data-type of result of operation}
    \label{data-type-result}

Many operations (defined by an operator or a function) produce a
  result whose data-type matches that of their operands/arguments (if
  these all have the same data-type). The following examples illustrate
  this for the 
  \emph{subtract} operator:
  \begin{verbatim}
% [nap "3 - 1"] all
::NAP::57-57  i32  MissingValue: -2147483648  References: 0  Unit: (NULL)
Value:
2
% [nap "3f32 - 1f32"] all
::NAP::61-61  f32  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
2
% [nap "3u8 - 1u8"] all
::NAP::65-65  u8  MissingValue: 255  References: 0  Unit: (NULL)
Value:
2
\end{verbatim}

  

What happens if the operands differ in data-type? Let's try
  adding 
  \texttt{f32} and 
  \texttt{f64} values:
  \begin{verbatim}
% [nap "234f32 + 3.5f64"] all
::NAP::40-40  f64  MissingValue: NaN  References: 0
Value:
237.5
\end{verbatim}

The result is of type 
  \texttt{f64}, so there is no loss of precision. Next let's
  try adding 
  \texttt{i32} and 
  \texttt{f32} values:
  \begin{verbatim}
% [nap "234 + 3.5f32"] all
::NAP::54-54  f64  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
237.5
\end{verbatim}

  

Why is the result 
  \texttt{f64} rather than 
  \texttt{f32}? This prevents possible loss of precision, as
  in:
  \begin{verbatim}
% [nap "f32(123456789) + 5f32"] all -format %d
::NAP::48-48  f32  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
123456800
\end{verbatim}

This is due to the fact that an 
  \texttt{i32} value has 31 bits (9.3 digits) of precision, whereas
  an 
  \texttt{f32} value has only 24 bits (7.2 digits) of precision. So
  both operands must be converted to 
  \texttt{f64} before the addition takes place. This is shown by:
  \begin{verbatim}
% [nap "123456789 + 5f32"] all -format %d
::NAP::43-43  f64  MissingValue: NaN  References: 0  Unit: (NULL)
Value:
123456794
\end{verbatim}

  

Some operations produce a result whose data-type is independent of
  the types of the operands. In particular, relational and logical
  operators always produce an 
  \texttt{i8} result with value 1 for true and 0 for false. The
  following illustrates the `\texttt{$>$}' (greater than) operator:
  \begin{verbatim}
% [nap "9 > 8"] all
::NAP::43-43  i8  MissingValue: (NULL)  References: 0
Value:
1
\end{verbatim}

